# restart_wsearch.py
# Sadə skript Windows Search (WSearch) servisini yenidən başlatmaq üçün.
# Administrator olaraq çalışdırın.

import sys
import subprocess

def is_admin():
    try:
        import ctypes
        return ctypes.windll.shell32.IsUserAnAdmin() != 0
    except Exception:
        return False

SERVICE_NAME = "WSearch"

if not is_admin():
    print("Administrator hüquqları tələb olunur. Skripti administrator olaraq işə salın.")
    sys.exit(1)

# Əvvəlcə pywin32 varsa onu istifadə etməyə çalışaq (daha etibarlı)
try:
    import win32serviceutil
    try:
        win32serviceutil.StopService(SERVICE_NAME)
    except Exception:
        # bəzən StopService istisna ata bilər, davam edək və Start etməyə çalışaq
        pass
    try:
        win32serviceutil.StartService(SERVICE_NAME)
        print(f"{SERVICE_NAME} servisi restart olundu.")
    except Exception as e:
        print(f"{SERVICE_NAME} servisi restart edilə bilmədi: {e}")
except ImportError:
    # pywin32 yoxdursa, sc əmrindən istifadə edək
    try:
        subprocess.run(["sc", "stop", SERVICE_NAME], check=True)
        subprocess.run(["sc", "start", SERVICE_NAME], check=True)
        print(f"{SERVICE_NAME} servisi restart olundu.")
    except subprocess.CalledProcessError as e:
        print(f"{SERVICE_NAME} servisi restart edilə bilmədi. Xəta kodu: {e.returncode}")